@model IEnumerable<CrudDemo.Models.UserQuizResult>

@{
    ViewData["Title"] = "Résultats des Quiz";
    var lesson = ViewBag.Lesson as CrudDemo.Models.Lesson;
    var correctCount = ViewBag.CorrectCount as int? ?? 0;
    var totalQuestions = ViewBag.TotalQuestions as int? ?? 0;
    var percentage = totalQuestions > 0 ? (correctCount * 100 / totalQuestions) : 0;
}

<div class="container mt-4">
    <div class="mb-3">
        <a asp-action="Lesson" asp-route-id="@lesson.Id" class="btn btn-secondary btn-sm">
            <i class="fas fa-arrow-left"></i> Retour à la leçon
        </a>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Résultats: @lesson.Title</h4>
        </div>
        <div class="card-body">
            <div class="row text-center">
                <div class="col-md-6">
                    <h3>@percentage%</h3>
                    <p>Score</p>
                </div>
                <div class="col-md-6">
                    <h3>@correctCount/@totalQuestions</h3>
                    <p>Bonnes réponses</p>
                </div>
            </div>
            <div class="progress mt-3" style="height: 25px;">
                <div class="progress-bar @(percentage >= 70 ? "bg-success" : percentage >= 50 ? "bg-warning" : "bg-danger")" role="progressbar" style="width: @percentage%" aria-valuenow="@percentage" aria-valuemin="0" aria-valuemax="100">
                    @percentage%
                </div>
            </div>
            <p class="mt-3 text-muted">
                @if (percentage >= 70)
                {
                    <span class="text-success"><i class="fas fa-check-circle"></i> Excellente performance!</span>
                }
                else if (percentage >= 50)
                {
                    <span class="text-warning"><i class="fas fa-exclamation-triangle"></i> Vous pouvez faire mieux. Réessayez!</span>
                }
                else
                {
                    <span class="text-danger"><i class="fas fa-times-circle"></i> Continuez à vous exercer pour améliorer votre score.</span>
                }
            </p>
        </div>
    </div>

    <h4>Détails des réponses</h4>
    <div class="list-group">
        @foreach (var result in Model)
        {
            <div class="list-group-item">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="mb-1">@result.Quiz.Question</h6>
                        <small class="text-muted">
                            Réponse: <strong>@(result.IsCorrect ? "✓ Correcte" : "✗ Incorrecte")</strong>
                        </small>
                        <br>
                        <small class="text-muted">@result.AttemptedAt.ToString("dd/MM/yyyy HH:mm")</small>
                    </div>
                    <span class="badge @(result.IsCorrect ? "bg-success" : "bg-danger")">
                        @(result.IsCorrect ? "✓" : "✗")
                    </span>
                </div>
            </div>
        }
    </div>

    <div class="mt-4">
        <a asp-controller="Courses" asp-action="Index" class="btn btn-primary">
            <i class="fas fa-book"></i> Retour aux Cours
        </a>
    </div>
</div>
